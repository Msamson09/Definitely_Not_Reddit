<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>


<main class="container">
    <h1 class="my-3"><%= title %></h1>
    <h1>Hello, <%= user ? user.profile.name : "friend" %></h1>
        <% if (user?.profile.avatar) { %>
        
        <% } %>
    <%# This is where our message creation form will go %> 
    <form action="/posts" method="POST">
        <h3>
        Write a Post
        </h3>
        <div id="post" class="mb-3 mx-5">
            <label for="title-input" class="form-label">Title</label>
            <input 
                type="text" 
                class="form-control" 
                id="title-input" 
                placeholder="Your title"
                name="title"
            >
        </div>
        <div id="post" class="col-10 mb-3 mx-5">
            <label for="post-content" class="form-label">Post</label>
            <textarea name="text" class="form-control form-control-lg" style="width: 30rem;" id="post-content" rows="5"></textarea>
        </div>
        <button id="post" class="btn btn-primary ms-5" type="submit">Create Post</button>
    </form>
    <% posts.forEach(post => { %>
        <div class="card" style="width: 40rem; margin-top: 5px;">
            <div class="card-body">
              <h2 class="card-title"><a href="/posts/<%= post._id %>" id=post-title><h2><%= post.title %></h2></a></h2>
              <h4 class="card-text"><%= post.text %></h4>
              <h5 class="card-subtitle mb-2 text-muted">Posted by: <%= post.author.name %></h5>
              <% if (user.profile._id.equals(post.author._id)) { %>
                <form action="/posts/<%= post._id %>?_method=DELETE" method="POST">
                    <button type="submit">Delete</button>
                </form>
                <a href="/posts/<%= post._id %>/edit">Update</a>
                <% } %>
            </div>
        </div>
    <% }) %>
        
     
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>   
</main>
<%- include('../partials/footer') %>

